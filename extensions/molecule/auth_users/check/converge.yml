---
- name: "Converge \u2014 auth_users (check)"
  hosts: localhost
  gather_facts: false
  vars_files:
  - vars.yml
  tasks:
  - name: Run module in check mode (predict change, do not apply)
    cisco.meraki_rm.meraki_auth_users:
      network_id: N_123456789012345678
      state: merged
      config:
      - '{{ expected_config }}'
    check_mode: true
    diff: true
    register: check_result
  - name: Assert check mode predicted a change
    ansible.builtin.assert:
      that:
      - check_result.changed == true
      - check_result.before is defined
      - check_result.after is defined
      fail_msg: Check mode did not predict a change
  - name: Assert diff output is present
    ansible.builtin.assert:
      that:
      - check_result.diff is defined
      - check_result.diff.before is defined
      - check_result.diff.after is defined
      fail_msg: Diff mode output missing from check result
